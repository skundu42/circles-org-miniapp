<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>MiniApps Org Manager</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="app-shell">
    <div class="card">
      <div class="title-row">
        <h1>MiniApps Org Manager</h1>
        <span class="badge badge-disconnected" id="badge">Not connected</span>
      </div>

      <!-- ── Login Section ─────────────────────────────────────── -->
      <div id="login-section" class="section">
        <p class="section-desc">
          Log in with your wallet in the Circles app to continue.
        </p>
      </div>

      <!-- ── Options Section ───────────────────────────────────── -->
      <div id="options-section" class="section hidden">
        <p class="section-desc">
          Builder focused setup for shop/game miniapps.
        </p>
        <p class="section-desc">
          Pick an org account or create one, then follow the step-by-step flow.
        </p>
        <div class="subsection">
          <h2>Your Organizations</h2>
          <div id="options-org-list">
            <p class="muted">Loading…</p>
          </div>
        </div>
        <button id="start-create-org-btn">Create Organization</button>
      </div>

      <!-- ── Register Section ──────────────────────────────────── -->
      <div id="register-section" class="section hidden">
        <p class="section-desc">
          Deploy a dedicated Safe for your organization and register it.
        </p>
        <div class="field">
          <label for="org-name">Organization Name</label>
          <input type="text" id="org-name" placeholder="My Organization" autocomplete="off" />
        </div>
        <div class="field">
          <label for="org-description">Description <span class="optional">(optional)</span></label>
          <textarea id="org-description" rows="3" placeholder="What does this organization do?"></textarea>
        </div>
        <button id="register-btn" disabled>Create an Organization</button>
        <button id="cancel-register-btn" class="btn-secondary">Back</button>
      </div>

      <!-- ── Organization Dashboard ────────────────────────────── -->
      <div id="dashboard-section" class="section hidden">

        <!-- Org Info -->
        <div class="info-box">
          <div class="info-row">
            <span class="info-label">Name</span>
            <span id="org-name-display">—</span>
          </div>
          <div class="info-row">
            <span class="info-label">Address</span>
            <span id="org-address-display" class="mono">—</span>
          </div>
          <div class="info-row">
            <span class="info-label">Balance</span>
            <span id="org-balance-display">0 CRC</span>
          </div>
        </div>
        <button id="back-to-options-btn" class="btn-secondary">Switch Organization</button>

        <div class="subsection">
          <h2>Step 1: Which CRC Can Users Pay With To Use your App?</h2>
          <div class="field">
            <div class="input-row">
              <input type="text" id="trust-address" placeholder="Search name/group or paste 0x…" autocomplete="off" />
              <button id="add-trust-btn">Allow CRC</button>
            </div>
          </div>
          <div id="trust-search-results">
          </div>
          <div id="trust-list">
            <p class="muted">Connect a wallet to view trust relations.</p>
          </div>
        </div>

        <div class="subsection">
          <h2>Step 2: Add An External Account As A Signer</h2>
          <div class="field">
            <label for="safe-signer-address">Use this EOA in your backend for automatic payouts from your Org</label>
            <div class="input-row">
              <input type="text" id="safe-signer-address" placeholder="0x…" autocomplete="off" />
              <button id="add-safe-signer-btn">Add signer</button>
            </div>
          </div>
          <div id="safe-signers-list">
            <p class="muted">Connect a wallet to load signers.</p>
          </div>
        </div>

        <div class="subsection">
          <h2>Step 3: Fund Added EOA With Gas</h2>
          <p id="fund-faucet-hint" class="muted">Add at least one EOA signer to enable funding.</p>
          <div class="field">
            <label for="fund-amount-xdai">Amount (CRC)</label>
            <input type="text" id="fund-amount-xdai" placeholder="0.0" autocomplete="off" />
          </div>
          <div id="fund-recipient-list">
            <p class="muted">Add an EOA signer first.</p>
          </div>
        </div>

        <div class="subsection">
          <h2>Step 4: Withdraw Collected CRC</h2>
          <p id="withdraw-available" class="muted">Available: 0 CRC</p>
          <div class="field">
            <label for="withdraw-amount-circles">Amount (CRC)</label>
            <div class="input-row">
              <input type="text" id="withdraw-amount-circles" placeholder="0.0" autocomplete="off" />
              <button id="withdraw-max-btn" class="btn-secondary">Max</button>
            </div>
          </div>
          <button id="withdraw-balance-btn" disabled>Send funds to me</button>
        </div>
      </div>

      <!-- ── Result Messages ───────────────────────────────────── -->
      <div id="result" class="result hidden"></div>
    </div>
  </div>

  <script type="module" src="main.js"></script>
</body>
</html>
